# 第六章 向量处理机

 向量处理机是有向量数据表示的处理机。

- 时间重叠：向量流水处理机

- 资源重复：阵列处理机

## 一、向量的流水处理与向量流水处理机

### 1、向量流水处理机

 向量内部各元素**很少相关**；

 一般执行同一个操作；

 容易发挥流水效能；

 向量数据表示 + 流水线 = 向量流水处理机

### 2、向量的流水处理

 		例如,要计算D=A*(B+C),其中,A、B、C、D都是具N个元素的向量。

 		如果采用逐个求向量元素的方法,即访存取![](F:\自考\计算机系统结构\img\2020-05-31_212409.jpg)、![](F:\自考\计算机系统结构\img\2020-05-31_212415.jpg)、![](F:\自考\计算机系统结构\img\2020-05-31_212429.jpg)，按上述算术表达式求出![](F:\自考\计算机系统结构\img\2020-05-31_212337.jpg),再取![](F:\自考\计算机系统结构\img\2020-05-31_212352.jpg)、![](F:\自考\计算机系统结构\img\2020-05-31_212358.jpg)、![](F:\自考\计算机系统结构\img\2020-05-31_212404.jpg)，求![](F:\自考\计算机系统结构\img\2020-05-31_212450.jpg)，这种处理方式我们称其为**横向(水平)处理方式**

 		如果采用先求E=B+C,再求D=A*E,这种处理方式我们称其为 **纵向（重复）处理方式**

 		如果向量的长度N太长,超出了向量寄存器组中寄存器的个数,可以将该向量分割成若干个组,使每组都能装得进向量寄存器组中这样,每一组内均按纵向方式处理,而组和组之间则采用软件方法编制循环程序的方法依次循环处理。我们称这种处理方式为**分组纵横处理方式**。有了这分组纵横处理的方式,就可以对向量长度N的大小不限制。CRAY—1就是采用这种方式来进行向量的流水处理的方式。

### 3、 CRAY—1向量流水处理机的结构

​		CRAY—1是由中央处理机、诊断维护控制处理机、大容量磁盘存贮子系统、前端处理机组成的功能分布异构型多处理机系统。中央处理机的控制部分里有总容量为256个16位的指令缓冲器,分成4组,每组为64个。

​		中央处理机的运算部分有12条可并行工作的单功能流水线,可分别流水地进行地址、向量、标量的各种运算。另外。还有可由流水线功能部件直接访问的向量寄存器组`V0~V7`、标量寄存器`S0~S7`及地址寄存器`A0~A7`。

![](F:\自考\计算机系统结构\img\2020-05-31_214816.jpg)

### 4、CRAY—1的四种向量指令

- 向量与向量   -----   B +  C
- 向量与标量   -----   B +  2
- 从主存中取一些数据放入向量（Load）
- 从向量中写入主存中

###  5、向量处理中的冲突:V冲突

​		所谓V冲突指的是,并行工作的各向量指令的源向量或结果向量使用了相同的Vi。除了相关情况之外,就是出现源向量冲突,例如

 `V4  ← V1+V2`

` 5 ← V1 ^ V3`

​		这两条向量指令不能同时执行,必须在第一条向量指令执行完,释放出`V1`之后,第二条向量指令才能开始执行。因为虽然这两条向量指令的源向量之一都取自`V1`,由于二者的首元素下标可能不同,向量长度也可能不同,难以由`V1`同时提供两条指令所需要的源向量。

###  6、向量处理中的冲突：功能冲突

​		所谓功能部件冲突指的是,同一个功能部件被一条以上的要求并行工作的向量指令所使用。例如

` V4 ← V2 * V3`

 `V5 ← V1 * V6`

​		这两条向量指令都需要使用浮点相乘流水功能部件，那就需在第一条向量指令执行到计算完最后一个结果分量，释放出功能部件之后,第二条向量指令才能开始执行。

### 7、 向量处理中的优化:链接

​		CRAY—1向量处理的另一个显著特点是,只要不出现功能部件冲突和源向量冲突,通过链接机构可使有数据相关的向量指令仍能重叠并行处理。例如,对前述向量运算

 D = A * (B+C)

若向量长度M≤64,向量为浮点数,则在B、C取到`V0、V1`后，可用以下3条向量指令求解:

 `V3 ← 存贮器(访存取A向量)`

 `V2 ← V0+V1(B向量和C向量浮点加)`

` V4 ← V23(浮点乘,存响量)`

- 通过连接技术实现向量指令之间大部分时间并行

  ![](F:\自考\计算机系统结构\img\2020-05-31_220433.jpg)

-  向量处理中的优化：链接性能分析

   CRAY—1启动访存,把元素送往功能部件,把结果存入Vi都需要有1拍的传送延迟。由于第一、二条指令之间没有冲突,可以同时执行,并且“访存”拍数正好与“浮加"的一样,因此,从访存开始,直至把第一个结果分量存入`V4`所需拍数(亦称为链接流水线的建立时间)为

  ![](F:\自考\计算机系统结构\img\2020-05-31_221053.jpg)

- 此后,每拍就可取得一个结果分量存入`V4`,一共只需17 + （N - 1）拍就可以执行完这3条向量指令,获得全部结果分量

  显然,这要比第一、二条指令全执行完，所有分量全部送入`V2、V3`后,才开始执行第三条指令要快的多，因为后者需`1+6+1+N-1+1+7+1+N-1 = 15 + 2N`拍。

## 二、阵列处理机的原理

### 1、阵列处理机构形1：分布式存贮器并行处理机

![](F:\自考\计算机系统结构\img\2020-05-31_222125.jpg)

### 2、阵列处理机构形2：集中式存贮器并行处理机

![](F:\自考\计算机系统结构\img\2020-05-31_222511.jpg)

### 3、 阵列处理机特点

1. 基于有限差分、矩阵、信号处理、线性规划等问题为背景,这些问题的共同特点是可以通过各种途径把它们转化成为对数组或向量的处理
2. 单指令流多数据流处理
3. 资源重复,而不是时间重叠
4. 利用并行性中的同时性,而不是并发性
5. 并行理机主要是靠增大处理单元个数来提高运算速度比起向量流水线处理机主要依靠缩短时钟周期来说，速度提高的潜力要大得多。

### 4、`ILLAC IV`的处理单元阵列结构

![](F:\自考\计算机系统结构\img\2020-05-31_224234.jpg)

## 三、SIMD计算机的互联网络

### 1、 互连网络的设计目标及互连函数

 处理单元之间、处理单元与存储分体之间。

 目标:

1. 不过分复杂,以降低成本
2. 灵活,满足算法和应用需求
3. 传递步数越少越好
4. 用基本构件组合而成,支持多级扩展

### 2、 互连函数

 互连函数表示互连网络的出端号和入端号的一一对应关系。

 所有入端x和出端f(x)都用二进制编码,从两者的二进制编码上找出其函数规律。

### 3、 基本的单级互连网络

- 立方体
- `PM2I`
- 混洗交换
- 蝶形单级网络

1. 立方体

   ![](F:\自考\计算机系统结构\img\2020-05-31_225456.jpg)

2. `PM2I`单级网络

   ![](F:\自考\计算机系统结构\img\2020-05-31_230021.jpg)

3. 混洗交换单级网络

   ![](F:\自考\计算机系统结构\img\2020-05-31_230435.jpg)

### 4、 基本的多级互连网络

- 多级立方体网络
- 多级混洗交换网络
- 多级`PM2I`网络
- 基准网络
- 多级交叉开关网络

1. 多级立方体

   ![](F:\自考\计算机系统结构\img\2020-05-31_230643.jpg)

2. 多级混洗交换网络

   ![](F:\自考\计算机系统结构\img\2020-05-31_230942.jpg)

3. 多级`PM2I`网络

   ![](F:\自考\计算机系统结构\img\2020-05-31_231111.jpg)

## 四、共享主存构形的阵列处理机中并行存储器的无冲突访问

### 1、情况1： 一维数组

一般没有问题

![](F:\自考\计算机系统结构\img\2020-05-31_231347.jpg)

按2次幂寻址M取质数

### 2、情况2：二维数组(按行存放)

行没有问题

列出问题

![](F:\自考\计算机系统结构\img\2020-05-31_231925.jpg)

### 3、情况2：二维数组(错位存放)

行没有问题

列没有问题

对角线出问题

![](F:\自考\计算机系统结构\img\2020-05-31_232344.jpg)

### 4、情况2：二维数组(错位存放改进)

行没有问题

列没有问题

对角线没有问题

![](F:\自考\计算机系统结构\img\2020-05-31_232945.jpg)

### 5、情况3：数组大小不固定

转为一维再放

## 五、脉动阵列流水处理机

### 1、脉动阵列图

![](F:\自考\计算机系统结构\img\2020-05-31_234642.jpg)

### 2、 脉动阵列结构举例

 例如,给出了在一个脉动式二维阵列结构上进行二个3×3矩阵A、B相乘的例子。每个处理单元PE内含一个乘法器和一个加法器,可完成一个内积步运算;每经一拍可把3个输入端送来的信息沿3个不同方向,即由左边水平方向、由下向上的垂直方向和由左下角到右上角斜45°方向,同时将结果传送到对应的3个输出线![](F:\自考\计算机系统结构\img\2020-05-31_235548.jpg)现设矩阵A、B分别输出。

![](F:\自考\计算机系统结构\img\2020-05-31_235933.jpg)

![](F:\自考\计算机系统结构\img\2020-06-01_000513.jpg)

### 3、 脉动阵列结构总结

 脉动阵列结构有如下一些特点:

1. 结构简单、规整,模块化强
2. 数据流和控制流的设计简单规整
3. 具有极高的计算并行性
4. 脉动阵列结构的构形与特定计算任务和算法密切相关