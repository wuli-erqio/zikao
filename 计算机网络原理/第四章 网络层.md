# 第四章 网络层

![](F:\自考\计算机网络原理\img\2020-06-05_165758.jpg)

## 第一节 网络层服务

 网络层的主要作用是将网络层数据报从**源主机**送达**目的主机**。

 主要功能包括:

1. 转发：分组从输入接口转移到输出接口;
2. 路由选择：决定分组经过的路由或路径。

![](F:\自考\计算机网络原理\img\2020-06-05_170431.jpg)

## 第二节 数据报网络与虚电路网络

### 一 、数据报网络

数据报网络:按照目的主机地址进行路由选择的网络。

特点:

1. 无连接;
2. 每个分组作为一个独立的数据报进行传送,路径也可能不同;
3. 分组可能出现乱序和丢失。

###  二、虚电路网络

虚电路网络在网络层提供面向连接的分组交换服务。

特点:

1. 建立一条网络层逻辑连接;
2. 不需要为每条虚电路分配独享资源(区别于电路交换);
3. 根据虚电路号沿虚电路路径按序发送分组。

## 第三节 网络互连与网络互连设备

 ### 一、异构网络互连

异构网络:两个网络的通信技术和运行的协议不同。

异构网络互连的基本策略:

1. 协议转换;
2. 构建虚拟互联网络。

![](F:\自考\计算机网络原理\img\2020-06-05_172806.jpg)

###  二、路由器

![](F:\自考\计算机网络原理\img\2020-06-05_173208.jpg)

![](F:\自考\计算机网络原理\img\2020-06-06_210307.jpg)

执行路由器的各种指令,包括路由协议的运行、路由计算以及路由表的更新维护等。

## 第四节 网络层拥塞控制

### 一、 网络拥塞

拥塞:一种持续过载的网络状态,此时用户对网络资源(包括链路带宽、存储空间和处理器处理能力等)的总需求超过了网络固有的容量。

 原因:

1. 缓冲区容量有限;
2. 传输线路的带宽有限;
3. 网络结点的处理能力有限;
4. 网络中某些部分发生了故障。

###  二、流量感知路由

流量感知路由:

根据网络负载动态调整,将网络流量引导到不同的链路上,均衡网络负载,从而延缓或避免拥塞发生。

解决网络负载的震荡现象:

1. 多路径路由;
2. 缓慢转移流量至另一链路。

###  三、准入控制

- 准入控制:

是一种广泛应用于虚电路网络的拥塞预防技术。

- 基本思想:

对新建虚电路进行审核,如果新建立的虚电路会导致网络变得拥塞,那么网络拒绝建立该新虚电路。

拥塞状况的量化:基于平均流量和瞬时流量。

###  四、流量调节

1. 感知拥塞
2. 处理拥塞:将拥塞信息通知到其上游结点。

 处理方法:

- (1)抑制分组:给拥塞数据报的**源主机**返回一个抑制分组
- (2)背压:让抑制分组在从拥塞结点到源结点的路径上的**每一跳**,都发挥抑制作用。

###  五、负载脱落

负载脱落:路由器主动丢弃某些数据报

如何选择要丢弃的数据报:

1. 丢弃新分组:如`GBN`
2. 丢弃老分组:如实时视频流

## 第五节 Internet网络层

### 一、`IPv4`协议

`IP`数据报格式：`IP`首部固定部分20字节

![](F:\自考\计算机网络原理\img\2020-06-07_205103.jpg)

`IP`数据报分片

 **标识：判断这些分片是否属于同一个`IP`数据报**

**标志：判断是否为最后一个分片**

**片偏移：判断各分片的先后顺序**

### 二、`IPv4`编址

`IPv4`地址长度：32位进制

点分十进制标记法

![](F:\自考\计算机网络原理\img\2020-06-07_210344.jpg)

```
转换技巧：  128 、64、32、16、8、4、2、1
101 = 01011010 = 64 + 32 + 4 + 1

```

分类地址：A、B、C、D、E五类

特殊地址、私有地址

![](F:\自考\计算机网络原理\img\2020-06-07_211116.jpg)

```
A类：网络号0-127    主机号：2^24-2
B类：网络号10加14位的0 - 10加14位的1 主机号：2^16-2
C类：网络号110加21位的0 - 110加21位的1 主机号：2^8-2
```

子网划分:

将一个较大的子网划分为多个较小子网的过程。

较大子网具有较短的网络前缀,较小子网具有稍长的前缀。

超网：将具有较长前缀的相对较小的子网合并为一个具有稍短前缀的相对较大的子网。

子网掩码：用来定义一个子网的网络前缀长度。

![](F:\自考\计算机网络原理\img\2020-06-07_215203.jpg)

###  三、动态主机配置协议

动态主机配置协议`DHCP`:

为网络内的主机提供动态`IP`地址分配服务。

1. `DHCP`服务器发现

2. `DHCP`服务器提供

3. `DHCP`服务器请求

4. `DHCP`确认

 ###   四、网络地址转换

网络地址转换NAT——使用私有地址访问互联

1. 从内网进入互联网的`IP`数据报:

   将其源`IP`地址替换为NAT服务器拥有的合法的公共`IP`地址,同时替换源端口号,并将替换关系记录到NAT转换表中;

2. 从互联网返回的`IP`数据报:

   依据其目的`IP`地址与目的端口号检索NAT转换表,得到内部私有P地址与端口号,替换目的`IP`地址和目的端口号,然后将`IP`数据报转发到内部网络。

###  五、`ICMP`

互联网控制报文协议(`ICMP`):

在主机或路由器间,实现差错信息报告。

`ICMP`差错报告报文共有5种:

 终点不可达、源点抑制、时间超时、参数问题和路由重定向等。

 `ICM`P询问报文:

 回声(echo)请求/应答、时间戳(`timestamp` )请求/应答。

###  六、`IPv6`

1. 解决`IPv4`地址耗尽的问题。

2. `IPv6`报文首部长度固定40字节。

3. `IPv6`地址长度128位。

4. `IPv4`到`IPv6`的迁移:

   双协议栈

   隧道

## 第六节 路由算法与路议

### 一 、链路状态路由选择算法

 链路状态路由选择算法是一种全局式路由选择算法。

 每个路由器通过从其它路由器获得的链路状态信息构建出整个网络的拓扑图。

 计算最短路径 —— Dijkstra算法

![](F:\自考\计算机网络原理\img\2020-06-08_093129.jpg)

###  二、距离向量路由选择算法

每个结点基于其**与邻居结点间的直接链路距离**,以及**邻居交换过来的距离向量**,计算并更新其到达每个目的结点的最短距离,然后将新的距离向量再通告给其所有邻居,直到距离向量不再改变。

 Bellman -ford方程:

![](F:\自考\计算机网络原理\img\2020-06-08_094245.jpg)

![](F:\自考\计算机网络原理\img\2020-06-08_094812.jpg)

###  三、层次化路由选择

实现大规模网络路由选择最有效的、可行的解决方案。

划分自治系统:

网关路由器

自治系统间路由协议

![](F:\自考\计算机网络原理\img\2020-06-08_104159.jpg)

###  四、Internet 路由选择协议

1. 内部网关协议

- RIP:

  基于距离向量路由选择算法,跳数作为距离度量,最大距离不超过**15跳**,**每30秒**交换一次距离向量。

- `OSPF`:

  基于链路状态路由选择算法。

2. 外部网关协议:

- `BGP `

##  本章小结

 本章重难点回顾:

1. `IP`协议数据报结构、`IP`数据报分片、`IP`地址、子网划分、路由聚合等;

2. 链路状态路由算法、距离向量路由算法。