# 第七章 文件系统

## 第一节 文件系统的基本概念

### 一、文件系统的任务

#### 1、文件的定义

- 研究文件系统的两种观点：

  用户观点：关心文件有什么组成，如何命名，如何保护文件，可以进行何种操作。

  系统观点：文件目录是怎样实现的，怎样管理存储空间，文件存储位置，磁盘实际运作方式，存取速度，磁盘利用率等等。

- 文件的定义：一组带标识的、在逻辑上有完整意义的信息项的序列
- 读写指针：读指针用来记录文件当前的读取位置，写指针用来记录文件当前的写入位置
- 特点：存储在磁盘，可长期保存。

#### 2、文件系统的定义

文件系统是操作系统中统一管理信息资源的一种软件。它管理文件的存储、检索、更新，提供更安全的共享和保护手段，并且方便用户使用。

功能： 

- 统一管理文件的存储空间，实施存储空间的分配与回收
- 实现文件按名存取，以对用户透明的方式管理命名空间
- 实现文件信息的共享，并提供文件的共享和保密措施
- 向用户提供一个方便使用的接口
- 系统维护及向用户提供有关信息
- 保持文件系统的执行效率
- 提供与I/O的统一接口

### 二、文件的存储介质及存取方式

#### 1、外存储设备的特点

特点：容量大、断点后仍可保存信息

组成：驱动部分和存储介质部分

种类：磁盘、磁带、磁鼓、纸带、光盘、闪存

#### 2、外存储设备的介质

##### (1) 磁带

![](F:\自考\操作系统\img\2020-05-21_154836.jpg)

特点：容量大，存取速度慢，适合顺序存储。

##### (2) 磁盘

分类：软盘和硬盘

特点：容量大，成本低，适合随机存储

![](F:\自考\操作系统\img\2020-05-21_155355.jpg)

##### (3) 光盘

是利用在激光的作用下特性发生变化的一些材料制成的非磁性记录介质

特点：容量大、速度快、价格便宜

##### (4) 闪存

特点：电擦除，随机存取、可靠性高、寿命长

#### 3、文件在存储设备中的存取方式

顺序存取：按从前到后的次序依次访问文件的各个信息项

随机存取：又称直接存取，允许用户按任意的次序、直接存取文件中的任意一个记录，或者根据存取命令把读写指针移到文件中的指定记录读取。

### 三、文件的分类

#### 1、按文件的用途分类

- 系统文件
- 库函数文件
- 用户文件

#### 2、按文件的组织方式分类

- 普通文件
- 目标文件
- 特殊文件

#### 3、一些常见的文件分类方式

- 按文件的保护方式：只读文件、读写文件、可执行文件、无保护文件
- 按信息的流向分：输入文件、输出文件、输入输出文件
- 按存放时限分：临时文件、永久文件、档案文件
- 按存储介质分：磁盘文件、磁带文件、卡片文件按等
- 按文件的组织结构分类：逻辑文件、物理文件

#### 4、UNIX类操作系统中文件的分类

- 普通文件
- 目录文件
- 特殊文件

## 第二节 文件的逻辑结构和物理结构

文件的逻辑结构：

从用户观点出发所观察到的文件组织形式

文件的物理结构：

又称为文件的存储结构。是指系统文件存储在外存上所形成的一种存储组织形式，是用户不能看见的。

### 一、文件的逻辑结构

#### 1、设计文件逻辑结构的原则

- 易于操作
- 查找快捷
- 修改方便
- 空间紧凑

#### 2、文件的逻辑结构

文件的逻辑结构所描述的信息是文件中信息的组织形式，可分为三/两类：

- 流式文件：有序字符的集合，基本单位是字符。源程序、目标代码等属于流式文件
- 记录式文件：是一组有序记录的集合，基本单位是记录。又可分为定长记录文件和变长记录文件

![](F:\自考\操作系统\img\2020-05-21_162635.jpg)

### 二、文件的物理结构

#### 1、顺序结构

- 顺序结构原理

  又称连续结构，他把逻辑上的连续文件信息依次存放在连续编号的物理块中。

![](F:\自考\操作系统\img\2020-05-21_163019.jpg)

- 顺序结构的优缺点

  - 优点

    存取速度快，一旦知道了问价在存储设备上的起始位置和文件长度，便能快速进行存取

    支持顺序存放和随机存放。

  - 缺点

    文件不能动态增长

    要求为一个文件分配连续的存储空间

    不能灵活的删除和插入记录

    出现碎片

#### 2、链接结构

- 链接结构原理

  将逻辑上连续的文件分散存储在若干个不连续的物理块中。每个物理块中都设有一个指针，指向其他后续的物理块。

  ![](F:\自考\操作系统\img\2020-05-21_170655.jpg)

- 优点

  解决了碎片问题，提高了磁盘空间利用率

  文件可以动态扩充

- 缺点

  存取速度慢，不适于随机存取

  可靠性差

#### 3、索引结构

- 索引结构原理

  为每个文件分配一个索引块(表)，把分配给该文件的所有盘块号，都记录在该索引块中

  ![](F:\自考\操作系统\img\2020-05-21_171155.jpg)

- 优点

  文件动态增长

  不要求为一个文件分配连续的存储空间

  能灵活删除和插入记录

  能顺序存取和随机存取

- 缺点

  引起较多的寻道次数和寻道时间

  索引表本身增加了存储空间的开销

- 多级索引

  当文件太大，其索引块太多，单级索引方式过于低效。此时，应为这些索引块在建立一级索引，称为第一季索引，及系统再分配一个索引块，作为一级索引的索引块，将第一块、第二块、...等索引块的盘块号，填入到此 索引表中，这样便形成了两级所用分配方式。如果文件非常大时，还可用三级、四级索引分配方式。

### 三、UNIX的三级索引结构

![](F:\自考\操作系统\img\2020-05-21_172651.jpg)

## 第三节 文件目录

### 一、文件控制块

#### 1、文件控制块（`FCB`）

为文件设置的用于描述和控制文件的数据结构。文件管理程序可借助于文件控制块中的信息，对文件施以各种操作。

#### 2、文件目录

文件控制块的有序集合(文件于文件控制块一一对应)称为文件目录，一个文件控制块就是一个文件目录项。

#### 3、文件控制块的内容

- 基本信息类：文件名、文件物理位置、文件逻辑结构、文件的物理结构
- 存取控制信息类：文件主的存取权限、核准用户的存取权限以及一般用户的存取权限
- 使用信息类：文件的创建日期和时间、文件上次修改的日期和时间、当前已经打开该文件的进程数、是否被其他进程锁住、文件在内存中是否已被修改但尚未拷贝到盘上等。

### 二、文件目录和当前目录

#### 1、一级目录结构

![](F:\自考\操作系统\img\2020-05-21_174114.jpg)

优点： 简单且能实现目录管理的基本功能一一按名存取

缺点：查找速度慢、不允许重名

#### 2、二级目录结构

为了改变一级目录文件目录命名冲突，并提高对目录文件检索速度而将目录分为两级

一级称为主文件目录，给出用户名，用户子目录所在的物理位置；二级称为用户文件目录，给出该用户所用文件的`FCB`

![](F:\自考\操作系统\img\2020-05-21_174643.jpg)

优点：解决了文件的崇明问题和文件共享问题，提高搜索速度，查找时间降低。

缺点：不太适合大量用户和大量文件的大系统，增加了系统的开销。

#### 3、多级目录

多级目录结构也称属性目录，产生于UNIX操作系统，已经被现代系统广泛使用。

![](F:\自考\操作系统\img\2020-05-21_175116.jpg)

优点：层次结构清晰，便于管理和保护；有利于文件的分类；解决重名问题；提高文件检索速度；能进行存取权限的控制。

缺点：查找一个文件按路径名逐层检查，由于每个文件都放在外存，多次放盘影响速度。

#### 4、当前目录于目录检索

当前目录：当前正在使用的目录(也称工作目录或值班目录)

目录检索：用户访问文件时，需要进行目录检索，这时用户给出文件名，系统按名找目录项

检索方法：全路径名（绝对路径名），相对路径。

### 三、目录项和目录文件

#### 1、目录项

一个文件控制块做成一个定长记录，这个记录称为目录项

#### 2、 目录文件

多个文件的文件控制块集中在一起组成了文件的目录

文件目录以文件的形式保存，该文件称为目录文件

### 四、目录项分解法

#### 1、目的

加快目录检索速度

#### 2、分解

目录项分解成两部分：符号目录项（次部）和基本目录项（主部）

符号目录项：包含文件名和文件项

基本目录项：除了文件名以外的`FCB`的其他全部信息

#### 3、优点

减少磁盘的访问次数，提高文件目录检索速度

![](F:\自考\操作系统\img\2020-05-21_180447.jpg)

### 五、UNIX的文件目录结构

#### 1、i结点的引入

文件目录通常时存放在磁盘上的，可能要占用大量的盘块。在查找目录的过程中，需要多次启动磁盘

UNIX系统，采用了把文件名与文件描述信息分开的办法，亦即，使文件描述信息单独形成一个称为索引结点的数据结构，简称为i结点。

![](F:\自考\操作系统\img\2020-05-21_180917.jpg)

#### 2、i结点的内容

文件中标识符、文件类型、文件存取权限、文件物理地址、文件长度、文件连接计数、文件存取时间等

#### 3、物理结构

同上述的三级索引结构

### 六、FAT文件系统的实现

FAT的含义：

文件分配表 -- File Allocation Table,最初为DOS系统设计，适合小容量的磁盘，分配给文件的所有盘块号都放在该表中

三个版本：

FAT-12、FAT-16、FAT-32